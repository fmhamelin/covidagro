<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>TD4 - COVIDAGRO</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">COVIDAGRO</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Bienvenue</a>
                            </li>
                            <li class="navitem">
                                <a href="../TD1/" class="nav-link">TD1</a>
                            </li>
                            <li class="navitem">
                                <a href="../TD2/" class="nav-link">TD2</a>
                            </li>
                            <li class="navitem">
                                <a href="../TD3/" class="nav-link">TD3</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">TD4</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../TD3/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#introduction-a-la-modelisation-en-epidemiologie-covid19-1er-confinement-estimation-de-la-reproductivite-du-virus" class="nav-link">Introduction à la modélisation en épidémiologie : COVID19 - 1er confinement - estimation de la reproductivité du virus</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#modele-epidemiologique" class="nav-link">Modèle épidémiologique</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#traitement-des-donnees" class="nav-link">Traitement des données</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ajustement-du-modele-aux-donnees" class="nav-link">Ajustement du modèle aux données</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#estimation-de-la-reproductivite-du-virus" class="nav-link">Estimation de la reproductivité du virus</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="introduction-a-la-modelisation-en-epidemiologie-covid19-1er-confinement-estimation-de-la-reproductivite-du-virus">Introduction à la modélisation en épidémiologie : COVID19 - 1er confinement - estimation de la reproductivité du virus</h1>
<p>Cécile Berthelot, Alizée Delarue, Aglaé Thieffry, Amélie Picchiottino (M1 Agro Rennes), le 15/03/2021.</p>
<p>Edité par Frédéric Hamelin et Marine Dorand (M1 MODE), le 28/04/2021.</p>
<h2 id="introduction">Introduction</h2>
<p>Nous nous sommes intéressées au cours de ce projet à la modélisation de l'épidémie de Covid-19 lors du premier confinement, à partir du 19 mars (par manque de données les jours précédents).</p>
<p>Pour cela, nous avons récolté des bases de données sur <a href="https://www.data.gouv.fr/fr/">data.gouv.fr</a>. Nous avons utilisé des données portant sur le nombre de tests réalisés en laboratoire de ville, le nombre de tests positifs, le nombre de décès à l'hôpital, le nombre de guérisons après hospitalisation. Nous n’avons pas utilisé de données sur les guérisons et les décès à domicile. Les données sont cumulées à partir du 19 mars.</p>
<p>Sources des données :</p>
<p><a href="https://www.data.gouv.fr/fr/datasets/donnees-hospitalieres-relatives-a-lepidemie-de-covid-19/">https://www.data.gouv.fr/fr/datasets/donnees-hospitalieres-relatives-a-lepidemie-de-covid-19/</a></p>
<p><a href="https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-tests-de-depistage-de-covid-19-realises-en-laboratoire-de-ville/">https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-tests-de-depistage-de-covid-19-realises-en-laboratoire-de-ville/</a></p>
<p>Notre étude s’appuie sur les travaux sur le confinement présentés dans cet article :</p>
<p><a href="https://www.frontiersin.org/articles/10.3389/fmed.2020.00274/full"><em>Roques L, Klein EK, Papaïx J, Sar A, and Soubeyrand S (2020) Impact of Lockdown on the Epidemic Dynamics of COVID-19 in France. Front. Med. 7:274.</em></a></p>
<h2 id="modele-epidemiologique">Modèle épidémiologique</h2>
<p>Les variables du modèle sont : </p>
<ul>
<li>
<script type="math/tex"> S(t) </script> : le nombre de personnes sensibles au temps <script type="math/tex"> t </script>, </li>
<li>
<script type="math/tex"> I(t) </script> : le nombre de personnes infectées et infectieuses, </li>
<li>
<script type="math/tex"> R(t) </script> : le nombre de personnes rétablies ou guéries,</li>
<li>
<script type="math/tex"> D(t) </script> : le nombre de personnes décédées. </li>
</ul>
<p>La taille de la population est <script type="math/tex">N=S+I+R</script>. </p>
<p>Les paramètres du modèles sont </p>
<ul>
<li>
<script type="math/tex"> \beta </script> : le taux de transmission de la maladie, </li>
<li>
<script type="math/tex"> \gamma </script> : le taux de guérison,</li>
<li>
<script type="math/tex"> \alpha </script> : le taux de mortalité due à la maladie.</li>
</ul>
<p>Ce sont des "taux" par unité de temps. </p>
<p><img alt="plot0" src="../figsTD4/plot0.svg" /></p>
<p>Le modèle s'écrit :
<script type="math/tex; mode=display">
\begin{eqnarray}
\frac{\mathrm{d}S}{\mathrm{d}t}&=&-\beta \frac{I}{N}S\,,\\
\frac{\mathrm{d}I}{\mathrm{d}t}&=&\beta \frac{I}{N}S - (\alpha+\gamma)I\,,\\
\frac{\mathrm{d}R}{\mathrm{d}t}&=&\gamma I\,,\\
\frac{\mathrm{d}D}{\mathrm{d}t}&=&\alpha I\,.
\end{eqnarray}
</script>
L'ajustement du modèle se fera par maximisation de la vraisemblance (<em>likelihood</em> en anglais). Cette méthode consiste à maximiser la probabilité des observations sachant les paramètres. Le modèle d'observation définit la probabilité qu'un test soit positif au temps <script type="math/tex">t​</script> d'après le modèle épidémiologique :
<script type="math/tex; mode=display">
p(t)=\frac{\sigma I(t)}{I(t)+\kappa S(t)}\,,
</script>
où <script type="math/tex"> \sigma ​</script> est la sensibilité des tests PCR (supposée connue) et <script type="math/tex">\kappa</script> est probabilité relative pour les individus sensibles de se faire tester comparativement aux infectés (à estimer). Aussi, le nombre de tests positifs le jour <script type="math/tex">t</script> peut être modélisé comme un tirage dans une loi Binomiale de paramètres <script type="math/tex">p(t)</script> et <script type="math/tex"> n(t) </script> (le nombre de tests réalisés le jour <script type="math/tex"> t </script>) : le nombre de nouveaux cas observés le jour <script type="math/tex">t</script> est
<script type="math/tex; mode=display">
c(t)\sim \mbox{Binomial}(n(t),p(t))
</script>
Nous faisons l'hypothèse que le nombre de décès cumulés observé au jour <script type="math/tex">t</script> est tiré dans une loi de Poisson de moyenne <script type="math/tex">D(t)</script> telle que donné par le modèle :
<script type="math/tex; mode=display">
D_{\small\mbox{data}}(t)\sim \mbox{Poisson}\left(D_{\small\mbox{model}}(t)\right)
</script>
En admettant que les observations sont indépendantes conditionnellement au modèle, la vraisemblance s'écrit :
<script type="math/tex; mode=display">
\mbox{Like}(\theta)=\prod_{t=0}^{T} \mbox{Prob}(\mbox{observe }c(t)|\mbox{ model predicts }p(t))\times \mbox{Prob}(\mbox{observe }D_{\small\mbox{data}}(t)|D_{\small\mbox{model}}(t))\,.
</script>
Soit <script type="math/tex"> \theta = \{ \beta, \kappa \} </script> le vecteur des paramètres à estimer. Rechercher les valeurs de <script type="math/tex">\theta</script> qui maximisent la vraisemblance est équivalent à rechercher les valeurs de <script type="math/tex">\theta</script> qui maximisent la log-vraisemblance, qui transforme le produit en somme :
<script type="math/tex; mode=display">
\mbox{logLike}(\theta)=\sum_{t=0}^T \log\left(\mbox{Prob}(\mbox{observe }c(t)|\mbox{ model predicts }p(t))\times \mbox{Prob}(\mbox{observe }D_{\small\mbox{data}}(t)|D_{\small\mbox{model}}(t))\right)\,.
</script>
Nous travaillerons avec la log-vraisemblance.</p>
<h2 id="traitement-des-donnees">Traitement des données</h2>
<p>Tout d’abord, nous pouvons nettoyer l’environnement de travail en effaçant les anciennes variables :</p>
<pre><code class="language-R">rm(list=ls())  # Efface les variables créées lors des exécutions précédentes
graphics.off() # Ferme les fenêtres ouvertes lors des exécutions précédentes
</code></pre>
<p>Nous importons les librairies nécessaires au projet :</p>
<pre><code class="language-R">library(deSolve) # pour la fonction ode (ordinary differential equation)
</code></pre>
<p>Nous baserons notre travail sur les données hospitalières suivantes :</p>
<ul>
<li>donnees-tests-covid19-labo-quotidien-2020-05-29-19h00.csv</li>
<li>donnees-hospitalieres-nouveaux-covid19-2020-05-10-19h00.csv</li>
</ul>
<p>Importons les données sous R :</p>
<pre><code class="language-R"># Lien permanent vers les données de tests
urltest = url(&quot;https://www.data.gouv.fr/fr/datasets/r/b4ea7b4b-b7d1-4885-a099-71852291ff20&quot;)
# Lien permanent vers les données d'hospitalisations
urlhosp = url(&quot;https://www.data.gouv.fr/fr/datasets/r/6fadff46-9efd-4c53-942a-54aca783c30c&quot;)

# Tableau lié aux données de tests
datatest = read.csv2(urltest, header=TRUE, sep=&quot;;&quot;)
# Tableau lié aux données d'hospitalisation
datahosp = read.csv2(urlhosp, header=TRUE, sep=&quot;;&quot;)
</code></pre>
<p>Pour les données liées aux tests, on gardera les données pour toutes les classes d’âges. On conserve seulement les lignes avec <code>clage\_covid=0</code> :</p>
<pre><code class="language-R">datatest=datatest[datatest$clage_covid == 0,]
</code></pre>
<p>Agrégation des données à l’échelle de la France (tous les départements français) par jour :</p>
<pre><code class="language-R"># Nombre de tests par jour
nb_test = aggregate(nb_test ~ jour, data = datatest, FUN = sum)
# Nombre de tests positifs par jour
nb_pos = aggregate(nb_pos ~ jour, data = datatest, FUN = sum)  
# Nombre de décès par jour
nb_deces = aggregate(incid_dc~ jour, data=datahosp, FUN = sum)
# Nombre quotidien de nouveaux retours à domicile
nb_gueris= aggregate (incid_rad~ jour, data=datahosp, FUN = sum)   
</code></pre>
<p>Le premier confinement s’est déroulé du 17 mars au 11 mai 2020. Mais les données d’hospitalisations commencent seulement le 19 mars. On sélectionne les données du 19 mars au 11 mai 2020 :</p>
<pre><code class="language-R">nb_test=nb_test[nb_test$jour&gt;&quot;2020-03-18&quot; &amp; nb_test$jour&lt;&quot;2020-05-12&quot;, ]
nb_pos=nb_pos[nb_pos$jour&gt;&quot;2020-03-18&quot; &amp; nb_pos$jour&lt;&quot;2020-05-12&quot;, ]
nb_deces = nb_deces[ nb_deces$jour&lt;&quot;2020-05-12&quot;, ]
nb_gueris = nb_gueris[ nb_gueris$jour&lt;&quot;2020-05-12&quot;, ]
</code></pre>
<p>Construction de vecteurs qui contiennent uniquement les données qui nous intéressent :</p>
<pre><code class="language-R">nb_test=nb_test[,2] # Nombre de tests
nb_pos=nb_pos[,2] # Nombre de tests positifs
nb_deces=nb_deces[,2] # Nombre de décès
nb_gueris=nb_gueris[,2] # Nombre de guéris (nb quotidien de nouveaux retours à domicile)
</code></pre>
<p>Construction de vecteurs avec les données cumulées avec la fonction <code>cumsum</code> :</p>
<pre><code class="language-R">TT=cumsum(nb_test) # Nombre de tests cumulés
PT=cumsum(nb_pos) # Nombre de tests positifs cumulés
DN=cumsum(nb_deces) # Nombre de décès cumulés
GN=cumsum(nb_gueris) # Nombre de guéris cumulés

LP = length(PT)
LT = length(TT)
LD = length(DN)
LG = length(GN)
</code></pre>
<p>Construction d’un vecteur du nombre de jours écoulé depuis le 19 mars jusqu’au 11mai :</p>
<pre><code class="language-R">temps = seq(from=1,to=54, by=1)
</code></pre>
<p>Nous avons représenté ci-dessous l’évolution du nombre de tests réalisés (courbe noire) et celle du nombre de tests positifs (courbe bleue) au cours du premier confinement.</p>
<pre><code class="language-R">plot(temps,TT,xlab=&quot;Temps écoulé depuis le 19 mars (en jours)&quot;,ylab=&quot;Nombre cumulé de tests&quot;,pch=16, col=&quot;black&quot;,main=&quot;Evolution des nombres de tests réalisés et de tests positifs 
au cours du premier confinement&quot;)
points(temps,PT,xlab=&quot;Temps écoulé depuis le 19 mars (en jours)&quot;,ylab=&quot;Nombre de tests positifs&quot;,pch=16, col=&quot;blue&quot;)
legend(&quot;topleft&quot;,legend=c(&quot;Nombre cumulé de tests réalisés&quot;,&quot;Nombre cumulé de tests positifs&quot;),pch=16,col=c(&quot;black&quot;,&quot;blue&quot;),bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-10-1.png" /></p>
<p>Nous avons représenté ci-dessous l’évolution du nombre de patients guéris (courbe verte) et celle du nombre de décès (courbe rouge) au cours du premier confinement.</p>
<pre><code class="language-R">plot(temps,GN,xlab=&quot;Temps écoulé depuis le 19 mars (en jours)&quot;,ylab=&quot;Nombre cumulé de cas&quot;,pch=16, col=&quot;dark green&quot;,main=&quot;Evolution des nombres de patients testés positifs, guéris ou décédés 
au cours du premier confinement&quot;)
points(temps,DN,xlab=&quot;Temps écoulé depuis le 19 mars (en jours)&quot;,ylab=&quot;Nombre de décès&quot;,pch=16,col=&quot;red&quot;)
points(temps,PT,xlab=&quot;Temps écoulé depuis le 19 mars (en jours)&quot;,ylab=&quot;Nombre de tests positifs&quot;,pch=16, col=&quot;blue&quot;)
legend(&quot;topleft&quot;,legend=c(&quot;Nombre cumulé de patients guéris&quot;,&quot;Nombre cumulé de patients décédés&quot;,&quot;Nombre cumulé de tests positifs&quot;),pch=16,col=c(&quot;dark green&quot;,&quot;red&quot;,&quot;blue&quot;),bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-11-1.png" /></p>
<p>Nous avons représenté ci-dessous la proportion du nombre cumulé de tests positifs sur le nombre cumulé de tests réalisés (courbe bleue) au cours du premier confinement.</p>
<pre><code class="language-R">PP = PT/TT # proportion de tests positifs
plot(temps,PP,xlab=&quot;Temps écoulé depuis le 19 mars (en jours)&quot;,ylab=&quot;Proportion de tests positifs&quot;,pch=16, col=&quot;blue&quot;, main=&quot;Proportion du nombre de tests positifs sur le nombre de tests réalisés au cours du premier confinement&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-12-1.png" /></p>
<p>Afin de pouvoir étudier l’évolution du nombre de décès durant le confinement, nous commençons notre étude à la date du 1er avril (13 jours après le 19 mars), car les décès sont retardés d’environ 2 semaines par rapport aux infections.</p>
<pre><code class="language-R">tau = 13 # Pour commencer le 1er avril
PT = PT[tau:LP]
TT = TT[tau:LT]
DN = DN[tau:LD]
GN = GN[tau:LG]
PP = PP[tau:length(PP)]
</code></pre>
<p>Nous nous intéressons maintenant au nombre de tests quotidiens effectués depuis le 1er avril :</p>
<pre><code class="language-R">pt = nb_pos[tau:LP] # Nombre de tests positifs quotidiens depuis le 1er avril
tt = nb_test[tau:LT] # Nombre de tests quotidiens depuis le 1er avril
dn = nb_deces[tau:LD] # Nombre de décès quotidiens depuis le 1er avril
</code></pre>
<pre><code class="language-R">lt = length(tt)
lp = length(pt)
ld = length(dn)
</code></pre>
<p>On redéfini un vecteur temps du nombre de jours écoulé depuis le 1er avril jusqu’au 11 mai :</p>
<pre><code class="language-R">temps = seq(from=1,to=42, by=1)
</code></pre>
<p>Nous représentons ci-dessous l’évolution quotidienne des nombres de tests réalisés (courbe noire) et de tests positifs (courbe bleue).</p>
<pre><code class="language-R">plot(temps,tt,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de tests quotidiens&quot;,pch=16, col=&quot;black&quot;,main = &quot;Evolution quotidienne des nombres de tests réalisés et de tests positifs&quot;)
points(temps,pt,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de tests quotidiens positifs&quot;,pch=16, col=&quot;blue&quot;)
legend(x=24, y=6000,legend=c(&quot;Nombre de tests quotidiens 
réalisés&quot;,&quot;Nombre de tests positifs quotidiens&quot;),pch=16,col=c(&quot;black&quot;,&quot;blue&quot;))
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-16-1.png" /></p>
<p>Nous représentons ci-dessous l’évolution quotidienne du nombre de patients positifs (courbe bleue) et de patients décédés (courbe rouge).</p>
<pre><code class="language-R">plot(temps,pt,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de cas quotidiens&quot;,pch=16,col=&quot;blue&quot;,main= &quot;Evolution quotidienne des nombres de patients positifs et de patients décédés&quot;)
points(temps,dn,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre quotidien de décès&quot;,pch=16, col=&quot;red&quot;)
legend(&quot;topright&quot;,legend=c(&quot;Nombre de tests quotidiens positifs&quot;,&quot;Nombre quotidien de patients décédés&quot;),pch=16,col=c(&quot;blue&quot;,&quot;red&quot;),bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-17-1.png" /></p>
<p>Nous avons représenté ci-dessous la proportion de tests positifs quotidiens sur le nombre de tests réalisés quotidien (courbe bleue) au cours du premier confinement.</p>
<pre><code class="language-R">pp = pt/tt # proportion de tests positifs quotidiens

plot(temps,pp,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Proportion de tests quotidiens positifs&quot;,pch=16, col=&quot;blue&quot;,main=&quot;Proportion de tests positifs quotidiens au cours du premier confinement&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-18-1.png" /></p>
<h2 id="ajustement-du-modele-aux-donnees">Ajustement du modèle aux données</h2>
<p>Nous définissons les paramètres de notre modèle :</p>
<pre><code class="language-R">N = 67e6 # Taille totale de la population
gamma = 1/10 # Taux de guérison (par jour) 
R_0 = 3 # Reproductivité du virus 
beta = gamma*R_0 # R0 = beta/gamma
sigma = 0.7 # Sensibilité des tests PCR
kappa = 5e-3 # Biais d'observation
alpha = 0.01 # Taux de mortalité
t0 = 1 # Correspond au 1er avril, la date du début de l'étude
theta0 = c(beta,kappa,alpha) # Vecteur des paramètres à estimer
</code></pre>
<p>Nous définissons les conditions initiales du modèle :</p>
<pre><code class="language-R">I0 = 1.5e6 # On fixe le nombre initial d'infectés d'après Roques et al 2020
R0 = N*0.01 # Inconnue : on suppose qu'au 1er avril il y avait 1% d'immunisés
D0 = DN[1]  # On se sert de la donnée initiale
S0 = N-I0-R0-D0
X0 = c(S0,I0,D0) # Vecteur d'état
</code></pre>
<p>Le temps est défini ci-dessous :</p>
<pre><code class="language-R">t = t0:lt
</code></pre>
<p>La fonction du modèle SIRD :</p>
<pre><code class="language-R">SIRD = function(t, X, P){ # X : vecteur d'état; P : paramètres du modèle
  beta = P[1] ; alpha = P[2]
  S = X[1] ; I = X[2] ; D = X[3]
  y = beta*S*I/N # Nombre de nouvelles infections par jour
  dS = -y
  dI = +y - gamma*I - alpha*I
  dD = +alpha*I
  dX = c(dS,dI,dD) # Variations de S, I et D mises à jour 
  return(list(dX))
}
</code></pre>
<p>La fonction qui calcule la vraisemblance des paramètres est définie ci-dessous :</p>
<pre><code class="language-R">logLike = function(theta){ # theta : vecteur des paramètres à estimer
  beta = theta[1]
  kappa = theta[2]
  alpha = theta[3]
  P = c(beta,alpha)
  X = ode(X0,t,SIRD,P) # X : vecteur des solutions du modèle SIRD

  # Proportion théorique de tests quotidiens positifs d'après le modèle 
  p1 = sigma*X[,3]/(X[,3]+kappa*X[,2])
  # Vraisemblance : calcule la probabilité d'observer pt en connaissant la probabilité théorique p1 qu'un test soit positif (loi binomiale) et d'observer dn en connaissant la quantité théorique quotidienne de décès basée sur le taux de mortalité alpha (loi de poisson)
  L = dbinom(pt, tt, p1, log=TRUE) + dpois(dn, alpha*X[,3], log=TRUE) 
  LL = sum(L)
  return(LL)
}
</code></pre>
<p>Nous cherchons ensuite à estimer et optimiser le jeu de paramètres <script type="math/tex"> \theta = \{\beta, \kappa, \alpha\} </script> de notre modèle à partir des estimations initiales <script type="math/tex"> \theta_0 = \{\beta_0, \kappa_0, \alpha_0\} </script> à l’aide d’une fonction optimisant la vraisemblance (<code>logLike</code>) :</p>
<pre><code class="language-R">opt = optim(theta0,logLike,control=list(fnscale=-1))

beta = opt$par[1] # On extrait les paramètres optimisés par notre modèle
kappa = opt$par[2]
alpha = opt$par[3]
P = c(beta,alpha) # P est le vecteur des paramètres utilisés pour la résolution des équations différentielles

print(paste(&quot;beta =&quot;,beta,&quot;; alpha =&quot;,alpha,&quot;; kappa =&quot;,kappa))
</code></pre>
<p>Nous trouvons <script type="math/tex"> \beta \approx 0.04 </script>, <script type="math/tex"> \alpha \approx 5.84\times 10^{-4} </script>, et <script type="math/tex"> \kappa \approx 0.05 </script>.</p>
<p>Nous utilisons ensuite nos paramètres optimisés pour résoudre notre système d’équations différentielles.</p>
<pre><code class="language-R">t = t0:42
# X : vecteur des solutions du modèle SIRD avec les paramètres optimisés
X = ode(X0,t,SIRD,P) 
</code></pre>
<p>Nous représentons ensuite sur un graphique les évolutions du nombre de tests positifs observées (courbe bleue) et théoriques (courbe noire) calculées à partir du modèle afin de vérifier la qualité de l’ajustement
du modèle :</p>
<pre><code class="language-R">p1 = sigma*X[,3]/(X[,3]+kappa*X[,2]) # Proportion théorique de tests quotidiens positifs

Sigma1 = cumsum(pt[t]) # Somme cumulée du nombre de tests positifs observés
Sigma2 = cumsum(tt[t]*p1) # Proportion de cas positifs cumulée issue du modèle

plot(t, Sigma1, xlab = &quot;Temps écoulé depuis le 1er avril (en jours)&quot;, ylab = &quot;Nombres de tests positifs théoriques et observés&quot;, main= &quot;Evolutions du nombre de tests positifs observées et théoriques&quot;,pch=16, col = &quot;blue&quot;)
lines(t,Sigma2)
legend(&quot;topleft&quot;,legend=&quot;Nombre de tests positifs observé&quot;,pch=16,col=&quot;blue&quot;,bty=&quot;n&quot;)
legend(x=0, y=24000,legend=&quot;Nombre de tests
positifs théorique&quot;,lty=1,col=&quot;black&quot;,bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-27-1.png" /></p>
<p>Nous comparons également à l’aide du graphique ci-dessous les évolutions des proportions théoriques (courbe noire) et observées (courbe bleue) des tests positifs quotidiens.</p>
<pre><code class="language-R">plot(t,pp[t],xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Proportions de tests quotidiens positifs théoriques et observées&quot;, main=&quot;Evolutions des proportions théoriques et observées 
des tests positifs quotidiens&quot;,pch=16, col=&quot;blue&quot;)
lines(t,p1) # p1 : Proportion de tests positifs théoriques 
legend(&quot;topright&quot;,legend=&quot;Proportion de tests positifs observée&quot;,pch=16,col=&quot;blue&quot;,bty=&quot;n&quot;)
legend(x=21, y=0.30,legend=&quot;Proportion de tests positifs théorique&quot;,lty=1,col=&quot;black&quot;,bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-28-1.png" /></p>
<p>Les graphiques suivant représentent les évolutions théoriques du nombre de personnes infectées au cours du temps, du nombre de personne saines et du nombre de personnes ayant été infectées depuis le début de l’épidémie.</p>
<pre><code class="language-R">plot(t,X[,3],col=&quot;blue&quot;,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de personnes infectées&quot;,pch=16, main=&quot;Evolution théorique du nombre de personnes infectées&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-29-1.png" /></p>
<pre><code class="language-R">plot(t,X[,2],col=&quot;purple&quot;,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de personnes saines&quot;,pch=16, main=&quot;Evolution du nombre théorique de personnes saines&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-29-2.png" /></p>
<pre><code class="language-R">plot(t,N-X[,2],xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de personnes ayant été infectées&quot;,pch=16, main=&quot;Evolution du nombre théorique de personnes ayant été infectées&quot;)
</code></pre>
<p><img alt="" src="TD4_files/figure-markdown_strict/unnamed-chunk-29-3.png" /></p>
<p>Nous représentons les évolutions du nombre de décès cumulés théoriques (courbe noire) et observées (courbe rouge).</p>
<pre><code class="language-R">plot(temps,DN,col=&quot;red&quot;,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de décès cumulés&quot;,pch=16,main=&quot;Evolutions du nombre de décès cumulés théoriques et observées&quot;)
lines(t,X[,4])
legend(&quot;topleft&quot;,legend=&quot;Nombre de décès observés&quot;,pch=16,col=&quot;red&quot;,bty=&quot;n&quot;)
legend(x=-1, y=17000,legend=&quot;Nombre de décès théoriques&quot;,lty=1,col=&quot;black&quot;,bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-30-1.png" /></p>
<p>Nous représentons les évolutions du nombre de décès quotidiens théoriques (courbe noire) et observées (courbe rouge).</p>
<pre><code class="language-R">plot(temps,dn,col=&quot;red&quot;,xlab=&quot;Temps écoulé depuis le 1er avril (en jours)&quot;,ylab=&quot;Nombre de décès quotidiens&quot;,pch=16, main=&quot;Evolutions du nombre de décès quotidiens théoriques et observées&quot;)
lines(t,alpha*X[,3])
legend(&quot;bottomleft&quot;,legend=&quot;Nombre de décès quotidiens observé&quot;,pch=16,col=&quot;red&quot;,bty=&quot;n&quot;)
legend(x=-1, y=200,legend=&quot;Nombre de décès quotidiens théorique&quot;,lty=1,col=&quot;black&quot;,bty=&quot;n&quot;)
</code></pre>
<p><img alt="" src="../figsTD4/unnamed-chunk-31-1.png" /></p>
<h2 id="estimation-de-la-reproductivite-du-virus">Estimation de la reproductivité du virus</h2>
<p>A l’aide de nos paramètres estimés, nous sommes en mesure de calculer le nombre de reproduction effectif du virus au cours du confinement :
<script type="math/tex; mode=display">
\mathcal R_e = \frac{\beta}{\gamma+\alpha}\frac{S(t_0)}{N}\,.
</script>
</p>
<pre><code class="language-R">R_e = beta/(gamma+alpha)*(S0/N) # Re : nombre de reproduction effectif du virus

print(paste(&quot;R_e=&quot;,R_e))
</code></pre>
<p><strong>Nous trouvons <script type="math/tex"> \mathcal R_e \approx 0.42 </script></strong>, ce qui est cohérent avec l'article de <a href="https://www.frontiersin.org/articles/10.3389/fmed.2020.00274/full?report=reader">Roques et al 2020</a>.</p>
<p>Nous pouvons également estimer le taux de létalité (IFR) du virus durant le 1er confinement :</p>
<pre><code class="language-R">IFR = alpha/(alpha+gamma) # Infection Fatality Ratio

print(paste(&quot;IFR=&quot;,Re))
</code></pre>
<p><strong>Nous trouvons un IFR de 0.58%</strong>, ce qui est comparable avec la valeur obtenue lors de la première flambée, voir par exemple le précédent article des mêmes auteurs :</p>
<p><em><a href="https://www.mdpi.com/2079-7737/9/5/97/htm">Roques, L., Klein, E. K., Papaix, J., Sar, A., &amp; Soubeyrand, S.  (2020). Using early data to estimate the actual infection fatality ratio from COVID-19 in France. Biology, 9(5), 97.</a></em></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
